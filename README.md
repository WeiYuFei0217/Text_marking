# Text_marking

2020年12月软件课设作品，文字标注软件



## 文件

#### workspace文件夹中为源代码

- GUI.py为主函数
- Main.py为单独自动标注的主函数
- global_value.py用于在不同文件间传递“全局变量”
- impor_list.py为库列表，需要在运行时读入

#### test_picture文件夹中为测试图片

- 两张以“(copy)”结尾的图片用于验证程序在遇到Excel中未有图片时的处理

#### Output_Excel文件夹中为自动标注出的结果（可直接通过程序读入进行后续操作）

#### Output_Picture文件夹中为自动标注出的结果（展示在图片上）

#### XML文件夹中为“转换Excek为XML”的输出



## 使用说明

#### 功能

- 基础功能

  - 图片显示

    - 打开单张图片

    - 打开图片文件夹

  - 绘制矩形框

  - 编辑文字

  - 删除框和对应文字

  - xml文件

    - 增添

    - 更新同名文件

- 拓展（实用性/易用性）功能

  - 菜单栏

    - 配置程序和输出

    - 一键转xml

    - 一键自动标注（可根据需求配置）

  - 提示框

    - 警告/提示窗口

    - 双选窗口(yes/no)

    - 三选窗口(yes/no/cancel)

  - 绘制辅助线

  - 鼠标滚轮放大

  - ctrl+左键拖动

  - 空格恢复适应窗口大小

  - 左键画框，自动弹出编辑框

    - 画框时屏蔽其它框，避免干扰

    - 弹出位置为绘制框右下方，与习惯绘制方向同向

    - 用最少动作完成标记任务

  - 删除操作

    - 右侧tree选中delete键

    - 右键框选批量删除
      - 不用一个一个del且更直观

  - 上下按键左/右旋转图像

  - 左右按键跳转到上/下一个文件

  - 双击编辑文本

    - 弹出窗口，保留原信息
      - 弹出位置为鼠标点击位置正下方，方便操作

    - 左侧对应框变蓝，帮助用户聚焦

    - 不添加点击左侧编辑右侧功能

      - 已有绘制后直接弹框的功能

      - 看文字才能知道自己标注的是否正确

  - 保存格式

    - 自动标注可选输出图片形式标注结果

    - 输出excel方便用户阅读以及存储（为主）

      - 首行冻结方便观察

      - 自动行宽方便观察

    - 输出xml方便作为机器学习数据集

  - 卷积神经网络

    - 检测

    - 方向分类器

    - 识别

  - 实时自动保存



#### 程序设计

- 分离程序块，尽可能复用函数

- 使用opencv实时处理弥补tkinter的功能不足

  - 图片放大：记录原图并在此基础上根据鼠标动作导致的wh变化resize（改变尺寸）、改变label位置（聚焦到鼠标位置）和剪裁（保证不会出框）

  - 图片移动：根据鼠标移动的相对距离改变图片label的左上角坐标并配合剪裁以保证不会出框

  - 绘制矩形框（先放大后渲染，保证框宽一定）：

    - 正常矩形框

    - 被选中蓝色矩形框

    - 框选删除蓝色矩形框

- 使用tkinter（十分令人后悔，很多功能都需要手动实现）
  - 布局方面采用相对布局，根据全局Win的四个参数自动调节元件位置

- 使用全局字典用于文件间传参

- 将图片与图片文件夹统一，方便管理和自动标注

- 使用xlarr、rectan存储文字和框的数据并在不同函数功能内操作

- 使用大量try/except，实现”尝试“动作



#### 未来展望

- 细节改进
  - entry框自动选中（减少一次手动点击）
  - 拖动残影问题！
  - 展示图片缩略图
- 功能改进
  - ctrl+z与ctrl+y
- 框架改进
  - 用self.代替global
  - 改用Qt
    - 可以直接通过拖动框进行微调
